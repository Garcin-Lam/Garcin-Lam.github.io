---
title: 从伪类和伪元素说起的知识点
date: 2017-03-19 19:45:04
tags: [Web, CSS3, W3C]
categories: [编执狂, Web]
---


---
title: 从伪类和伪元素说起的知识点
date: 2017-03-19 19:45:04
tags: [Web, CSS3, W3C]
categories: [编执狂, Web]
---


在YY的一轮面试之后，和工作室的小伙伴一起讨论了"CSS伪类和伪元素"(因为就有一个面试问题是问"遇到过哪些伪类和伪元素，使用的场景有哪些？")，发现牵扯进来的边边角角还是挺多的，就用一篇文章来记录一下，如果有更多涉及两者的知识点，欢迎补充~

## 伪类和伪元素的区别

在刚开始学习前端的时候，我根本就没有注意到**伪类**和**伪元素**说的是两个不同的东西，毕竟都是`:xxx`来表示。在MDN查询`document.querySelectorAll()`的API时，跳转到了[伪元素](https://developer.mozilla.org/zh-CN/docs/Web/CSS/Pseudo-elements)

> 就像 pseudo classes (伪类)一样...

然后就意识到两者的不同，而且`document.querySelectorAll()`的[中文翻译](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/querySelectorAll)也搞混了，英文版本的是说`querySelectorAll()`的选择器语法不支持`伪元素`而不是`伪类`。以伪类中的`:target`为例子，可以正确返回结果，见下图所示，可见两者还是很容易混淆的。

![:target伪类](http://7xobsp.com1.z0.glb.clouddn.com/2017-03-20_161608_0001.jpg)

(有一个小插曲，想吐槽一下MDN。在很久之前就发现了翻译页面的错误，那时也想着改正，但是MDN编辑语法什么的真是orz，后来就放弃了，因为学习成本还算挺高的。一直到写这篇文章的时候，又记起这件事，实在忍不住，改正了翻译，不到100个字，花了我半个多小时...)


**那么问题来了，如何区分两者？**

在[一篇博客](http://www.alloyteam.com/2016/05/summary-of-pseudo-classes-and-pseudo-elements/)中的一张图已经为我们归纳了两者，

![两者区别的归纳图](http://7xobsp.com1.z0.glb.clouddn.com/2017-03-20_161854_0002.jpg)

但是这并不是正确的打开方式，这只是知其然不知其所以然。

让我们回归**W3C规范**看看，规范是怎么对[伪元素](https://www.w3.org/TR/2011/REC-css3-selectors-20110929/#pseudo-elements)和[伪类](https://www.w3.org/TR/2011/REC-css3-selectors-20110929/#pseudo-classes)进行定义的。

> The pseudo-class concept is introduced to permit selection based on information that lies outside of the document tree or that cannot be expressed using the other simple selectors.
> 简单翻译：伪类这个概念的引入，是为了允许(authors)对那些在文档树之外或无法使用简单css选择器表示的信息(ps:个人感觉"文档树之外的状态"和"css选择器表示的元素"会更贴切)进行选择获取

> Pseudo-elements create abstractions about the document tree beyond those specified by the document language. For instance, document languages do not offer mechanisms to access the first letter or first line of an element's content.
> 简单翻译：在文档语言规定之外，伪元素创建了一个关于文档树的抽象引用。比如，文档语言并未提供获取元素的第一个字或者第一行的机制。

orz，差别在哪？

如果你想看看别人对两者的解读，可以看看[stackoverflow这个回答以及评论区的讨论](http://stackoverflow.com/questions/8069973/what-is-the-difference-between-a-pseudo-class-and-a-pseudo-element-in-css#answer-11701951)

**按照我个人的理解：**`伪类`侧重描述(descript,not filter)以不同于简单选择器选择存在的元素(比如`:first-child`)或元素的特殊状态(比如`:hover`)。而`伪元素`侧重的是虚拟的元素，比如`:first-letter`，就好像**真实地存在文档树中**一样，但实际上是不存在的，而`:first-child`指向的元素是存在于文档树的，这是两者的不同。这大概也是为什么`querySelectorAll()`适用于`伪类`而不适用于`伪元素`的原因吧--因为前者是真实存在于DOM树，但是后者并不是。

## 伪元素和伪类的选择器优先级

这方面的知识是在写这篇文章不久前才接触的。总的来说，伪元素的优先级和标签的优先级是一样的，而伪类的优先级和类以及属性选择器等等的优先级是相同的。

如果就这么简单地介绍完这个小节，那也就不必大费周章了。我们来解读[W3C中关于选择器优先级计算的部分](https://www.w3.org/TR/CSS2/cascade.html#specificity)~

> A selector's specificity is calculated as follows: 
> 
> 1. count 1 if the declaration is from is a 'style' attribute rather than a rule with a selector, 0 otherwise (= a) (In HTML, values of an element's "style" attribute are style sheet rules. These rules have no selectors, so a=1, b=0, c=0, and d=0.)
> 2. count the number of ID attributes in the selector (= b)
> 3. count the number of other attributes and pseudo-classes in the selector (= c)
> 4. count the number of element names and pseudo-elements in the selector (= d)

总的来说就是，每个行内样式(`style=""`)以`1000`计，每个id选择器以`100`计，其他属性选择器和伪类选择器以`10`计，标签和伪元素选择器以`1`计，而通配符`*`以`0`计。注意，这里只是提供一个计算的方便，并不是11个类的选择器可以将一个id选择器的样式覆盖掉。

还有一点，HTML行内样式可以被JavaScript的style覆盖，而JavaScript的行内样式可以被`!important`的样式覆盖。

官方还给出了一些例子：

``` css
 *             {}  /* a=0 b=0 c=0 d=0 -> specificity = 0,0,0,0 */
 li            {}  /* a=0 b=0 c=0 d=1 -> specificity = 0,0,0,1 */
 li:first-line {}  /* a=0 b=0 c=0 d=2 -> specificity = 0,0,0,2 */
 ul li         {}  /* a=0 b=0 c=0 d=2 -> specificity = 0,0,0,2 */
 ul ol+li      {}  /* a=0 b=0 c=0 d=3 -> specificity = 0,0,0,3 */
 h1 + *[rel=up]{}  /* a=0 b=0 c=1 d=1 -> specificity = 0,0,1,1 */
 ul ol li.red  {}  /* a=0 b=0 c=1 d=3 -> specificity = 0,0,1,3 */
 li.red.level  {}  /* a=0 b=0 c=2 d=1 -> specificity = 0,0,2,1 */
 #x34y         {}  /* a=0 b=1 c=0 d=0 -> specificity = 0,1,0,0 */
 style=""          /* a=1 b=0 c=0 d=0 -> specificity = 1,0,0,0 */


```

## 层叠次序

这只是选择器Selector的优先级，而样式的确定不仅仅是由选择器的优先级这一个因素来确定，还有层叠次序。

W3C规范的[6.4.1 Cascading order](https://www.w3.org/TR/CSS2/cascade.html#cascading-order)小节中有说明最终决定一个元素的样式的步骤：

> 1. Find all declarations that apply to the element and property in question, for the target media type.Declarations apply if the associated selector matches the element in question and the target medium matches the media list on all @media rules containing the declaration and on all links on the path through which the style sheet was reached.
> 2. Sort according to importance (normal or important) and origin (author, user, or user agent). In ascending order of precedence:
2.1. user agent declarations
2.2. user normal declarations
2.3. author normal declarations
2.4. author important declarations
2.5. user important declarations
> 3. Sort rules with the same importance and origin by specificity of selector: more specific selectors will override more general ones. Pseudo-elements and pseudo-classes are counted as normal elements and classes, respectively.
> 4. Finally, sort by order specified: if two declarations have the same weight, origin and specificity, the latter specified wins. Declarations in imported style sheets are considered to be before any declarations in the style sheet itself.

用图形来概括就是：


![优先级](http://olpvawdcl.bkt.clouddn.com/2017-03-20_195002_0003.jpg)

>  Declarations in imported style sheets are considered to be before any declarations in the style sheet itself.

英文水平有限的我，看到这句话的时候，一直搞不懂讲的是什么，误以为"import和link导入的样式会被看成是在`<style>`之前"。（不知道各位会翻译成什么样子呢哈哈）但是直到看[Cascading Styles](http://library.salve.edu/lsc548/tutorials/css/css.html)中讲到：

> Note: If the link to the external style sheet is placed after the internal style sheet in HTML <head>, the external style sheet will override the internal style sheet!

决定用例子来试试，看看那句话说的是什么。

![代码示例](http://olpvawdcl.bkt.clouddn.com/20170320201147.jpg)

从图片中可以看出，样式最终选择的是`blue`，因为篇幅问题，大家可以在自己的电脑上试试，验证一下：优先级相同，以`<style>`，`<link>`的出现顺序来定义声明出现的顺序。

那最后的一句话真正的含义是什么？

我觉得应该是在讲，在**同一个**样式表中，`@import`的规则总是在其他规则的前面。

>  In CSS 2.1, any @import rules must precede all other rules (except the @charset rule, if present). -- https://www.w3.org/TR/CSS2/cascade.html#at-import








